# 食堂就餐卡系统设计

## 场景
* 系统中每个消费者都有一张卡，在管理中心注册缴费，卡内记着消费者的身份、余额。
* 使用时将卡插入收款机则显示卡上金额，服务员按收款机上数字键，收款机自动计算并显示消费额及余额。
* 管理中心的管理员监视每一笔消费，可打印出消费情况的相关统计数据。

## 系统用例图

```plantuml
@startuml
title 系统用例图

left to right direction

actor 消费者 as ac_cus
actor 服务员 as ac_srv
actor 管理员 as ac_adm

package 管理中心 {
    usecase "注册" as uc_reg
    usecase "充值" as uc_rech
    usecase "监视消费数据" as uc_monit
    usecase "打印统计数据" as uc_print
}

package 收款机 {
    usecase "收款，显示消费额及余额" as uc_check
}

ac_cus --> uc_reg
ac_cus --> uc_rech
ac_srv --> uc_check
ac_adm --> uc_monit
ac_adm --> uc_print

@enduml
```

## 组件图

```plantuml
@startuml

title 组件图

() "读写卡控制器" as nfc
() "打印机控制器" as printer
[用户认证模块] as auth 
[饭卡信息模块] as card 
[收款机接入模块] as cashier
[记账模块] as trade
[数据库] as db
[消费监控] as web
[数据报表] as report

web ..> trade
report ..> printer
report ..> trade
card ..> nfc
card ..> trade
cashier ..> trade
web ..> auth
report ..> auth
auth ..> db
trade ..> db

@enduml
```

## 组件时序图

### 注册缴费

```plantuml
@startuml

title 时序图-注册缴费

actor 管理员

管理员 -> 饭卡信息模块: 办理新的饭卡
activate 饭卡信息模块
饭卡信息模块 -> 读写卡控制器: 保存余额到饭卡中
activate 读写卡控制器
读写卡控制器 -> 饭卡信息模块: 写入成功
deactivate 读写卡控制器
饭卡信息模块 -> 记账模块: 记录充值记录
activate 记账模块
记账模块 -> 饭卡信息模块: 记账成功
deactivate 记账模块
饭卡信息模块 -> 管理员: 新卡办理成功
deactivate 饭卡信息模块

@enduml
```

### 消费记账

```plantuml
@startuml

title 时序图-消费记账

actor 服务员

服务员 -> 收款机: 输入消费金额
activate 收款机
opt 余额 >= 消费金额
收款机 -> 收款机: 读取余额，并写入新的余额
收款机 -> 服务员: 显示消费金额及余额
收款机 -> 记账模块: 记账
activate 记账模块
记账模块 --> 收款机: 记账成功
deactivate 记账模块
else 余额 < 消费金额
收款机 -> 收款机: 读取余额，并警告消费失败
收款机 -> 服务员: 显示余额
end
deactivate 收款机

@enduml
```

### 打印统计数据

```plantuml
@startuml

title 时序图-打印统计数据

actor 管理员

管理员 -> 浏览器: 选择统计数据范围
activate 记账模块
记账模块 -> 浏览器: 返回统计数据
浏览器 -> 打印机控制器: 打印统计数据
activate 打印机控制器
打印机控制器 -> 打印机控制器: 打印
打印机控制器 -> 浏览器: 打印成功
deactivate 打印机控制器
浏览器 -> 管理员: 打印成功

@enduml
```

## 部署图

```plantuml
@startuml

title 部署图

left to right direction

control 收款机
control 读写卡机
rectangle 服务容器 {
    component 记账模块
    component 消费监控
    component 数据报表
    component 饭卡信息模块
    component 收款机接入模块
    component 用户认证模块
}

database db [
    业务数据库
]

node 网页服务器 
card 浏览器
control 打印机控制器

浏览器 -- 网页服务器 : HTTP
浏览器 --- 服务容器 : HTTP
浏览器 -- 打印机控制器

饭卡信息模块 --- 读写卡机 : 设备驱动
收款机接入模块 --- 收款机: TCP/IP
服务容器 --- db

@enduml
```
